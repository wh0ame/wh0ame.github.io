{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Ivan\\\\Desktop\\\\Deplom-master \\u2014 \\u043A\\u043E\\u043F\\u0438\\u044F\\\\src\\\\catalog\\\\Catalog.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport { supabase } from '../supabaseClient';\nimport SmallHeader from '../layouts/SmallHeader';\nimport ApartmentCard from './ApartmentCard';\nimport './Catalog.css';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport default function Catalog() {\n  _s();\n  const [selectedApartment, setSelectedApartment] = useState(null);\n  const [apartments, setApartments] = useState([]);\n  const [userFavorites, setUserFavorites] = useState([]);\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n  useEffect(() => {\n    checkUser();\n    fetchApartments();\n  }, []);\n  useEffect(() => {\n    if (user) {\n      fetchUserFavorites();\n    }\n  }, [user]);\n  async function checkUser() {\n    const {\n      data: {\n        user\n      }\n    } = await supabase.auth.getUser();\n    setUser(user);\n  }\n  async function fetchApartments() {\n    try {\n      setLoading(true);\n      const {\n        data,\n        error\n      } = await supabase.from('apartments').select('*');\n      if (error) throw error;\n      setApartments(data || []);\n    } catch (error) {\n      console.error('Error fetching apartments:', error.message);\n    } finally {\n      setLoading(false);\n    }\n  }\n  async function fetchUserFavorites() {\n    try {\n      const {\n        data,\n        error\n      } = await supabase.from('user_apartments').select('apartment_id').eq('user_id', user.id).eq('favorite', true);\n      if (!error && data) {\n        setUserFavorites(data.map(item => item.apartment_id));\n      }\n    } catch (error) {\n      console.error('Error fetching favorites:', error.message);\n    }\n  }\n  async function handleToggleFavorite(apartmentId) {\n    if (!user) {\n      alert('Для добавления в избранное необходимо авторизоваться');\n      return;\n    }\n    try {\n      const isFavorite = userFavorites.includes(apartmentId);\n      if (isFavorite) {\n        // Удаляем из избранного\n        const {\n          error\n        } = await supabase.from('user_apartments').delete().eq('user_id', user.id).eq('apartment_id', apartmentId);\n        if (!error) {\n          setUserFavorites(prev => prev.filter(id => id !== apartmentId));\n        }\n      } else {\n        // Добавляем в избранное\n        const {\n          error\n        } = await supabase.from('user_apartments').upsert({\n          user_id: user.id,\n          apartment_id: apartmentId,\n          favorite: true,\n          last_viewed: new Date().toISOString()\n        });\n        if (!error) {\n          setUserFavorites(prev => [...prev, apartmentId]);\n        }\n      }\n    } catch (error) {\n      console.error('Error updating favorites:', error.message);\n    }\n  }\n  if (loading) return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: \"Loading apartments...\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 102,\n    columnNumber: 23\n  }, this);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(SmallHeader, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"container\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"apartments__title\",\n        children: /*#__PURE__*/_jsxDEV(\"h2\", {\n          className: \"title-2 text-center m-11\",\n          children: \"\\u041D\\u0430\\u0448\\u0438 \\u043A\\u0432\\u0430\\u0440\\u0442\\u0438\\u0440\\u044B\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 109,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"apartments__cards\",\n        children: apartments.map(apartment => /*#__PURE__*/_jsxDEV(ApartmentCard, {\n          apartment: apartment,\n          isFavorite: userFavorites.includes(apartment.id),\n          onToggleFavorite: handleToggleFavorite,\n          onDetailsClick: setSelectedApartment\n        }, apartment.id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 113,\n          columnNumber: 13\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 7\n    }, this), selectedApartment && /*#__PURE__*/_jsxDEV(ApartmentModal, {\n      apartment: selectedApartment,\n      onClose: () => setSelectedApartment(null),\n      isFavorite: userFavorites.includes(selectedApartment.id),\n      onToggleFavorite: handleToggleFavorite\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(Footer, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n}\n\n// Остальной код (ApartmentModal и Footer) остается таким же\n_s(Catalog, \"gEO+AVrOp3RX5qLnjkjmfCJQBso=\");\n_c = Catalog;\nvar _c;\n$RefreshReg$(_c, \"Catalog\");","map":{"version":3,"names":["React","useState","useEffect","supabase","SmallHeader","ApartmentCard","jsxDEV","_jsxDEV","Fragment","_Fragment","Catalog","_s","selectedApartment","setSelectedApartment","apartments","setApartments","userFavorites","setUserFavorites","user","setUser","loading","setLoading","checkUser","fetchApartments","fetchUserFavorites","data","auth","getUser","error","from","select","console","message","eq","id","map","item","apartment_id","handleToggleFavorite","apartmentId","alert","isFavorite","includes","delete","prev","filter","upsert","user_id","favorite","last_viewed","Date","toISOString","children","fileName","_jsxFileName","lineNumber","columnNumber","className","apartment","onToggleFavorite","onDetailsClick","ApartmentModal","onClose","Footer","_c","$RefreshReg$"],"sources":["C:/Users/Ivan/Desktop/Deplom-master — копия/src/catalog/Catalog.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { supabase } from '../supabaseClient';\r\nimport SmallHeader from '../layouts/SmallHeader';\r\nimport ApartmentCard from './ApartmentCard';\r\nimport './Catalog.css';\r\n\r\nexport default function Catalog() {\r\n  const [selectedApartment, setSelectedApartment] = useState(null);\r\n  const [apartments, setApartments] = useState([]);\r\n  const [userFavorites, setUserFavorites] = useState([]);\r\n  const [user, setUser] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    checkUser();\r\n    fetchApartments();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (user) {\r\n      fetchUserFavorites();\r\n    }\r\n  }, [user]);\r\n\r\n  async function checkUser() {\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n    setUser(user);\r\n  }\r\n\r\n  async function fetchApartments() {\r\n    try {\r\n      setLoading(true);\r\n      const { data, error } = await supabase\r\n        .from('apartments')\r\n        .select('*');\r\n      \r\n      if (error) throw error;\r\n      setApartments(data || []);\r\n    } catch (error) {\r\n      console.error('Error fetching apartments:', error.message);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  async function fetchUserFavorites() {\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from('user_apartments')\r\n        .select('apartment_id')\r\n        .eq('user_id', user.id)\r\n        .eq('favorite', true);\r\n      \r\n      if (!error && data) {\r\n        setUserFavorites(data.map(item => item.apartment_id));\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching favorites:', error.message);\r\n    }\r\n  }\r\n\r\n  async function handleToggleFavorite(apartmentId) {\r\n    if (!user) {\r\n      alert('Для добавления в избранное необходимо авторизоваться');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const isFavorite = userFavorites.includes(apartmentId);\r\n      \r\n      if (isFavorite) {\r\n        // Удаляем из избранного\r\n        const { error } = await supabase\r\n          .from('user_apartments')\r\n          .delete()\r\n          .eq('user_id', user.id)\r\n          .eq('apartment_id', apartmentId);\r\n        \r\n        if (!error) {\r\n          setUserFavorites(prev => prev.filter(id => id !== apartmentId));\r\n        }\r\n      } else {\r\n        // Добавляем в избранное\r\n        const { error } = await supabase\r\n          .from('user_apartments')\r\n          .upsert({\r\n            user_id: user.id,\r\n            apartment_id: apartmentId,\r\n            favorite: true,\r\n            last_viewed: new Date().toISOString()\r\n          });\r\n        \r\n        if (!error) {\r\n          setUserFavorites(prev => [...prev, apartmentId]);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Error updating favorites:', error.message);\r\n    }\r\n  }\r\n\r\n  if (loading) return <div>Loading apartments...</div>;\r\n\r\n  return (\r\n    <>\r\n      <SmallHeader />\r\n      <div className=\"container\">\r\n        <div className=\"apartments__title\">\r\n          <h2 className=\"title-2 text-center m-11\">Наши квартиры</h2>\r\n        </div>\r\n        <div className=\"apartments__cards\">\r\n          {apartments.map(apartment => (\r\n            <ApartmentCard\r\n              key={apartment.id}\r\n              apartment={apartment}\r\n              isFavorite={userFavorites.includes(apartment.id)}\r\n              onToggleFavorite={handleToggleFavorite}\r\n              onDetailsClick={setSelectedApartment}\r\n            />\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      {selectedApartment && (\r\n        <ApartmentModal\r\n          apartment={selectedApartment}\r\n          onClose={() => setSelectedApartment(null)}\r\n          isFavorite={userFavorites.includes(selectedApartment.id)}\r\n          onToggleFavorite={handleToggleFavorite}\r\n        />\r\n      )}\r\n\r\n      <Footer />\r\n    </>\r\n  );\r\n}\r\n\r\n// Остальной код (ApartmentModal и Footer) остается таким же"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}